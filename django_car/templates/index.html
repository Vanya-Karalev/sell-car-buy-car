{% extends 'base.html' %}
{% load static %}

{% block styles %}
    <link rel="stylesheet" href="{% static 'styles.css' %}"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
{% endblock styles %}

{% block content %}
    <body>
    <div class="container-name">
        <a><b>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ üî•</b></a>
    </div>

    <div class="container">
        <div class="content">
            {% for ad in ads %}
                <div class="card">
                    <div class="card-image">
                        {% if ad.images.all %}
                            <img src="{{ ad.images.all.0.image.url }}" alt="Car Image">
                        {% else %}
                            <img src="{% static '–∫—á–∞—É.jpg' %}" alt="Car Image">
                        {% endif %}
                    </div>
                    <div class="card-info">
                        <h2>{{ ad.car.brand.name }} {{ ad.car.model.name }}</h2>
                        <p>–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞: {{ ad.car.year }}</p>
                        <p>–¶–µ–Ω–∞: {{ ad.price }}—Ä.</p>
                        <p>–ü—Ä–æ–±–µ–≥: {{ ad.car.mileage }}–∫–º.</p>
                        <a href="{% url 'carinfo' ad_id=ad.id %}">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
    <div id="btn" style="padding-left: 80px; height: 30px; width: 150px;">
        <button type="button" style="height: 30px; border-radius: 5px; width: 150px; border: none; cursor: pointer;">–ü–æ–∫–∞–∑–∞—Ç—å –µ—à–µ</button>
    </div>
    {{ total_ads|json_script:"json-total" }}
    <script>
        {#var _current_item = $('.card').length;#}
        {#console.log(_current_item);#}
        const loadBtn = $('#btn');
        const spinner = $('#spinner');
        const total = JSON.parse($('#json-total').text());
        const alert = $('#alert');
        const contantContainer = $('.content');

        function loadmorePost() {
            const _current_item = $('.card').length;

            $.ajax({
                url: '{% url 'load' %}',
                type: 'GET',
                data: {
                    'total_item': _current_item
                },
                beforeSend: function () {
                    loadBtn.addClass('not-visible');
                    spinner.removeClass('not-visible');
                },
                success: function (response) {
                    const data = response.ads;
                    console.log(data);
                    spinner.addClass('not-visible');
                    data.forEach(ad => {
                        const carHTML = ad.brand_name && ad.model_name
                            ? `<h2>${ad.brand_name} ${ad.model_name}</h2>`
                            : '<h2>Car Information Not Available</h2>';

                        const imagesHTML = ad.image
                            ? `<img src="/media/${ad.image}" alt="Car Image">`
                            : `<img src="{% static '–∫—á–∞—É.jpg' %}" alt="Car Image">`;

                        const yearHTML = ad.year
                            ? `<p>–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞: ${ad.year}</p>`
                            : '<p>–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞: N/A</p>';

                        const priceHTML = ad.price
                            ? `<p>–¶–µ–Ω–∞: ${ad.price}—Ä.</p>`
                            : '<p>–¶–µ–Ω–∞: N/A</p>';

                        const mileageHTML = ad.mileage
                            ? `<p>–ü—Ä–æ–±–µ–≥: ${ad.mileage}–∫–º.</p>`
                            : '<p>–ü—Ä–æ–±–µ–≥: N/A</p>';

                        const detailsLink = `<a href="/buycar/${ad.id}">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>`;

                        contantContainer.append(`
        <div class="card">
            <div class="card-image">
                ${imagesHTML}
            </div>
            <div class="card-info">
                ${carHTML}
                ${yearHTML}
                ${priceHTML}
                ${mileageHTML}
${detailsLink}
            </div>
        </div>`
                        );
                    });

                    if (_current_item == total) {
                        alert.removeClass('not-visible');
                    } else {
                        loadBtn.removeClass('not-visible');
                    }
                },
                error: function (err) {
                    console.log(err);
                }
            });
        }

        loadBtn.on('click', () => {
            loadmorePost();
        });


    </script>
    </body>
{% endblock content %}
