{% extends 'base.html' %}
{% load static %}

{% block styles %}
    <link rel="stylesheet" href="{% static 'buy.css' %}"/>
    <script src="{% static 'buy.js' %}"></script>
{% endblock styles %}

{% block content %}
    <body>

    <div class="row">
        <div class="ads_column">
            <div class="container-name">
                <a><b>Купить автомобиль</b></a>
            </div>

            <div class="filter">
                <form method="post" action="{% url 'buycar' %}">
                    {% csrf_token %}
                    <div class="filter_row" style="padding-left: 7px;">
                        <div class="filter_column">
                            <div class="field">
                                <div class="dropdown_brand" onclick="toggleDropdown()" id="dropdownContainer">
                                    <input type="text" name="selected_brand_name" placeholder="Марка" class="dropbtn"
                                           id="selectedBrandBtn"
                                           oninput="filterFunction(this.value)"
                                           value="{{ brand_name }}">
                                    <div class="dropdown-content">
                                        {% for brand in brands %}
                                            <a class="car-brand" data-brand-id="{{ brand.id }}"
                                               data-brand="{{ brand.name }}"
                                               onclick="selectBrand(this)">{{ brand.name }}</a>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>

                            <div class="field">
                                <input type="number" name="start_year" placeholder="Год от" id="start_year"
                                       value="{{ start_year }}" class="left">
                                <input type="number" name="end_year" placeholder="до" id="end_year"
                                       value="{{ end_year }}" class="right">
                            </div>
                        </div>

                        <div class="filter_column">
                            <div class="field">
                                <div class="dropdown_model" onclick="toggleModelDropdown()" id="dropdownModelContainer">
                                    <input type="text" name="selected_model_name" placeholder="Модель" class="dropbtn"
                                           id="selectedModelBtn" disabled
                                           oninput="filterModelFunction(this.value)" value="{{ model_name }}">
                                    <div class="dropdown-content" id="modelDropdown" data-brand-id="">
                                        {% for model in models %}
                                            <a class="car-model" data-brand-id="{{ model.brand.id }}"
                                               data-model="{{ model.name }}"
                                               onclick="selectModel(this)">{{ model.name }}</a>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>

                            <div class="field">
                                <input type="number" name="start_mileage" placeholder="Пробег от" id="start_mileage"
                                       value="{{ start_mileage }}" class="left">
                                <input type="number" name="end_mileage" placeholder="до" id="end_mileage"
                                       value="{{ end_mileage }}" class="right">
                            </div>
                        </div>

                        <div class="filter_column">
                            <div class="field">
                                <input type="number" name="start_price" placeholder="Цена от" id="start_price"
                                       value="{{ start_price }}" class="left" style="margin-top: 10px">
                                <input type="number" name="end_price" placeholder="до" id="end_price"
                                       value="{{ end_price }}" class="right" style="margin-top: 10px">
                            </div>
                            <div class="field">
                                <button type="submit"
                                        style="border-bottom-left-radius: 5px; border-top-left-radius: 5px; margin-left: 5px;">
                                    Показать
                                </button>
                                <button onclick="clearFields()"
                                        style="border-bottom-right-radius: 5px; border-top-right-radius: 5px;">
                                    Сбросить
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <div class="container">
                <div class="content">
                    {% for ad in ads %}
                        <div class="card">
                            <div class="card-image">
                                {% if ad.images.all %}
                                    <img src="{{ ad.images.all.0.image.url }}" alt="Car Image">
                                {% else %}
                                    <img src="{% static 'кчау.jpg' %}" alt="Car Image">
                                {% endif %}
                            </div>
                            <div class="card-info">
                                <div class="card-info_up">
                                    <a href="{% url 'carinfo' ad_id=ad.id %}"
                                       class="car_name">{{ ad.car.brand.name }} {{ ad.car.model.name }}</a>
                                    <div class="car_short_info">
                                        <p>{{ ad.car.year }} г.</p>
                                        {% for engine in ad.car.engines.all %}
                                            <p>{{ engine.capacity }} л, {{ engine.type|lower }}</p>
                                        {% endfor %}
                                        <p>{{ ad.car.body_type|lower }}</p>
                                        <p>{{ ad.car.mileage }} км</p>
                                    </div>
                                    <p class="car_price">{{ ad.price }} р.</p>

                                    {% if request.user.is_authenticated %}
                                        <form method="post" action="{% url 'favorite' ad_id=ad.id %}">
                                            {% csrf_token %}
                                            {% if ad.id in favorite_ads %}
                                                <button class="car_favorite_button" type="submit">
                                                    <svg aria-hidden="true" height="40" viewBox="0 0 24 24" width="40"
                                                         xmlns="http://www.w3.org/2000/svg" fill="gold"
                                                         stroke="goldenrod">
                                                        <path class="stroke"
                                                              d="M15.5 6h-7c-.274 0-.5.226-.5.5v9.757l3.981-2.661L16 16.269V6.5c0-.274-.226-.5-.5-.5zM7 4h10c.549 0 1 .451 1 1v14.068a.503.503 0 0 1-.777.416L11.984 16l-5.206 3.48A.5.5 0 0 1 6 19.064V5c0-.549.451-1 1-1z"></path>
                                                        <path class="fill"
                                                              d="M7 4h10c.549 0 1 .451 1 1v14.068a.505.505 0 0 1-.777.416L11.984 16l-5.206 3.48A.5.5 0 0 1 6 19.064V5c0-.549.451-1 1-1z"></path>
                                                    </svg>
                                                </button>
                                            {% else %}
                                                <button class="car_favorite_button" type="submit">
                                                    <svg aria-hidden="true" height="40" viewBox="0 0 24 24" width="40"
                                                         xmlns="http://www.w3.org/2000/svg" fill="white"
                                                         stroke="goldenrod">
                                                        <path class="stroke"
                                                              d="M15.5 6h-7c-.274 0-.5.226-.5.5v9.757l3.981-2.661L16 16.269V6.5c0-.274-.226-.5-.5-.5zM7 4h10c.549 0 1 .451 1 1v14.068a.503.503 0 0 1-.777.416L11.984 16l-5.206 3.48A.5.5 0 0 1 6 19.064V5c0-.549.451-1 1-1z"></path>
                                                        <path class="fill"
                                                              d="M7 4h10c.549 0 1 .451 1 1v14.068a.505.505 0 0 1-.777.416L11.984 16l-5.206 3.48A.5.5 0 0 1 6 19.064V5c0-.549.451-1 1-1z"></path>
                                                    </svg>
                                                </button>
                                            {% endif %}
                                        </form>
                                    {% endif %}

                                </div>
                                <div class="card-info_down">
                                    <p class="car_description">{{ ad.description }}</p>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>

        </div>
        <div class="reklama_column">
            <img src='https://exiterra.ru/images/sst/mem5.webp'/>
        </div>
    </div>

    </body>
{% endblock content %}
